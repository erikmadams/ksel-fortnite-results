<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSEL Match Results Entry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="max-w-6xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg mb-6 p-6 border-l-4 border-red-500">
            <div class="flex items-center justify-between mb-0 min-h-[72px]">
                <div class="flex items-center">
                    <img src="https://raw.githubusercontent.com/erikmadams/ksel-fortnite-results/main/KSEL_Header_Black_48x198.png" alt="KSEL Logo" style="height: 48px; width: 198px;" class="rounded" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="flex items-center justify-center text-white font-bold rounded text-lg" style="background-color: #EE2A3E; height: 48px; width: 198px; display: none;">
                        KSEL
                    </div>
                </div>
                
                <div class="flex-1 text-center">
                    <h1 class="text-3xl font-bold text-gray-800">Match Results Entry</h1>
                    <p class="text-gray-600">Enter Player and Team results</p>
                </div>
                
                <div class="flex gap-2">
                    <button 
                        onclick="saveResults()"
                        class="text-white px-6 rounded-lg inline-flex items-center justify-center text-center gap-2 font-medium transition-colors hover:opacity-90 h-11"
                        style="background-color: #EE2A3E"
                    >
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Save Results
                    </button>
                    <button class="bg-gray-500 hover:bg-gray-600 text-white px-6 rounded-lg inline-flex items-center justify-center text-center gap-2 font-medium transition-colors h-11">
                        <i data-lucide="x" class="w-4 h-4"></i>
                        Cancel
                    </button>
                </div>
            </div>
            
            <div id="status" class="hidden mt-4 p-3 rounded-lg"></div>
        </div>

        <!-- Two-panel grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Match Information Panel (1 column) -->
            <div class="md:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 text-left flex items-center gap-2">
                        <i data-lucide="info" class="w-5 h-5 text-red-600"></i>
                        Match Information
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School</label>
                            <select
                                id="school" class="h-11 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                            >
                                <option value="">Select School...</option>
                                <option value="Arvin">Arvin</option>
                                <option value="Bakersfield High">Bakersfield High</option>
                                <option value="Bakersfield Christian">Bakersfield Christian</option>
                                <option value="Centennial">Centennial</option>
                                <option value="Central Valley">Central Valley</option>
                                <option value="Cesar Chavez">Cesar Chavez</option>
                                <option value="Del Oro">Del Oro</option>
                                <option value="Delano High">Delano High</option>
                                <option value="East High">East High</option>
                                <option value="Foothill">Foothill</option>
                                <option value="Frontier">Frontier</option>
                                <option value="Golden Valley">Golden Valley</option>
                                <option value="Highland">Highland</option>
                                <option value="Independence">Independence</option>
                                <option value="Liberty">Kern Valley</option>
                                <option value="Liberty">Liberty</option>
                                <option value="Mira Monte">Mira Monte</option>
                                <option value="North">North</option>
                                <option value="Ridgeview">Ridgeview</option>
                                <option value="Robert F Kennedy">Robert F Kennedy</option>
                                <option value="Shafter">Shafter</option>
                                <option value="South">South</option>
                                <option value="Stockdale">Stockdale</option>
                                <option value="Tierra Del Sol">Tierra Del Sol</option>
                                <option value="Valley High">Valley High</option>
                                <option value="Vista">Vista</option>
                                <option value="Vista West">Vista West</option>
                                <option value="Wasco">Wasco</option>
                                <option value="West">West</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Team Name</label>
                                <select
                                    id="teamName" class="h-11 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                >
                                    <option value="">Select Team...</option>
                                    <option value="AHS Clouds">AHS Clouds</option>
                                    <option value="AHS EarthQuakes">AHS EarthQuakes</option>
                                    <option value="AHS Thunderstikes">AHS Thunderstikes</option>
                                    <option value="BCHS Eagles">BCHS Eagles</option>
                                    <option value="BHS 1">BHS 1</option>
                                    <option value="BHS 2">BHS 2</option>
                                    <option value="BHS 3">BHS 3h</option>
                                    <option value="CHS Hawks">CHS Hawks</option>
                                    <option value="Central Valley 1">Central Valley 1</option>
                                    <option value="Chavez 1">Chavez 1</option>
                                    <option value="Chavez 2">Chavez 2</option>
                                    <option value="Chavez 3">Chavez 3</option>
                                    <option value="DOHS Suns">DOHS Suns</option>
                                    <option value="DOHS JV">DOHS JV</option>
                                    <option value="Delano 1">Delano 1</option>
                                    <option value="EBHS 1">EBHS 1</option>
                                    <option value="FHS 1">FHS 1</option>
                                    <option value="FTHS Saja Boys">FTHS Saja Boys</option>
                                    <option value="FTHS 2">FTHS 2</option>
                                    <option value="FTHS 3">FTHS 3</option>
                                    <option value="FTHS 4">FTHS 4</option>
                                    <option value="GVHS 1">GVHS 1</option>
                                    <option value="GVHS 2">GVHS 2</option>
                                    <option value="HHS 1">HHS 1</option>
                                    <option value="HHS 2">HHS 2</option>
                                    <option value="IHS 1">IHS 1</option>
                                    <option value="KVHS 925ers">KVHS 925ers</option>
                                    <option value="KVHS ICFish">KVHS ICFish</option>
                                    <option value="LHS 1">LHS 1</option>
                                    <option value="LHS 2">LHS 2</option>
                                    <option value="MMHS Monkeys">MMHS Monkeys</option>
                                    <option value="MMHS M.A.R.V.">MMHS M.A.R.V.</option>
                                    <option value="MMHS F.A.M.E.">MMHS F.A.M.E.</option>
                                    <option value="NHS Destoyers">NHS Destoyers</option>
                                    <option value="NHS Try Hards">NHS Try Hards</option>
                                    <option value="NHS Gas Guzzlers">NHS Gas Guzzlers</option>
                                    <option value="NHS Bob The Builders">NHS Bob The Builders</option>
                                    <option value="NHS 41">NHS 41</option>
                                    <option value="NHS Millimeter Defeaters">NHS Millimeter Defeaters</option>
                                    <option value="RHS 1">RHS 1</option>
                                    <option value="RHS 2">RHS 2</option>
                                    <option value="RHS 3">RHS 3</option>
                                    <option value="RHS 4">RHS 4</option>
                                    <option value="RFK DreamTeam">RFK DreamTeam</option>
                                    <option value="RFK FlameDrift">RFK FlameDrift</option>
                                    <option value="RFK GSquad">RFK GSquad</option>
                                    <option value="SHHS JARS">SHHS JARS</option>
                                    <option value="SHHS All Nighters">SHHS All Nighters</option>
                                    <option value="SHHS Avengers">SHHS Avengers</option>
                                    <option value="SHS 1">SHS 1</option>
                                    <option value="SHS 2">SHS 2</option>
                                    <option value="STHS Mustangs">STHS Mustangs</option>
                                    <option value="STHS Colts">STHS Colts</option>
                                    <option value="STHS Broncos">STHS Broncos</option>
                                    <option value="TDS 1">TDS 1</option>
                                    <option value="TDS 2">TDS 2</option>
                                    <option value="TDS 3">TDS 3</option>
                                    <option value="Valley 1">Valley 1</option>
                                    <option value="Valley 2">Valley 2</option>
                                    <option value="Valley 3">Valley 3</option>
                                    <option value="VWHS 1">VWHS 1</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                <input
                                    type="date"
                                    id="date" value="2025-09-03" class="h-11 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                />
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Game Mode</label>
                            <select
                                id="gameMode" class="h-11 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                            >
                                <option>Battle Royale</option>
                                <option>Zero Build</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scoring Guide Panel (2 columns) as a SIBLING -->
            <div class="md:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Scoring System</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between p-2 bg-yellow-50 rounded">
                            <span class="font-medium">1st Place</span>
                            <span class="font-bold text-yellow-600">25 points</span>
                        </div>
                        <div class="flex justify-between p-2 bg-gray-50 rounded">
                            <span>2nd - 5th</span>
                            <span class="font-medium">20 points</span>
                        </div>
                        <div class="flex justify-between p-2 bg-gray-50 rounded">
                            <span>6th - 9th</span>
                            <span class="font-medium">15 points</span>
                        </div>
                        <div class="flex justify-between p-2 bg-gray-50 rounded">
                            <span>10th - 18th</span>
                            <span class="font-medium">10 points</span>
                        </div>
                        <div class="flex justify-between p-2 bg-gray-50 rounded">
                            <span>19th - 25th</span>
                            <span class="font-medium">5 points</span>
                        </div>
                        <div class="flex justify-between p-2 bg-blue-50 rounded">
                            <span>Per Elimination</span>
                            <span class="font-bold text-blue-600">4 points</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Entry Panel (full width below) -->
            <div class="md:col-span-3">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-2 text-left flex items-center gap-2">
                            <i data-lucide="users" class="w-5 h-5 text-red-600"></i>
                            Team Results
                        </h2>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Team Placement</label>
                            <input
                                type="number"
                                id="teamPlacement"
                                placeholder="Enter team placement (1-100)"
                                min="1"
                                max="100"
                                class="w-48 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500"
                            />
                        </div>
                    </div>

                    <div class="overflow-hidden rounded-lg border border-gray-200">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-700">Player</th>
                                        <th class="px-3 py-3 text-left text-xs font-medium text-gray-700">Gamer Tag</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Elims</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Assists</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Revives</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Accuracy</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Dmg to Players</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Dmg Taken</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Distance</th>
                                        <th class="px-2 py-3 text-center text-xs font-medium text-gray-700">Hits</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-3 py-3"><span class="font-medium text-gray-800">Player 1</span></td>
                                        <td class="px-3 py-3"><input type="text" id="player1_gamerTag" placeholder="Enter gamer tag..." class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_eliminations" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_assists" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_revives" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_accuracy" placeholder="0.0" step="0.1" min="0" max="100" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_damageToPlayers" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_damageTaken" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_distanceTraveled" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player1_hits" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-3 py-3"><span class="font-medium text-gray-800">Player 2</span></td>
                                        <td class="px-3 py-3"><input type="text" id="player2_gamerTag" placeholder="Enter gamer tag..." class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_eliminations" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_assists" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_revives" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_accuracy" placeholder="0.0" step="0.1" min="0" max="100" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_damageToPlayers" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_damageTaken" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_distanceTraveled" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player2_hits" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-3 py-3"><span class="font-medium text-gray-800">Player 3</span></td>
                                        <td class="px-3 py-3"><input type="text" id="player3_gamerTag" placeholder="Enter gamer tag..." class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_eliminations" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_assists" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_revives" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_accuracy" placeholder="0.0" step="0.1" min="0" max="100" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_damageToPlayers" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_damageTaken" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_distanceTraveled" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player3_hits" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                    </tr>
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-3 py-3"><span class="font-medium text-gray-800">Player 4</span></td>
                                        <td class="px-3 py-3"><input type="text" id="player4_gamerTag" placeholder="Enter gamer tag..." class="w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_eliminations" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_assists" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_revives" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_accuracy" placeholder="0.0" step="0.1" min="0" max="100" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_damageToPlayers" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_damageTaken" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_distanceTraveled" placeholder="0" min="0" class="w-20 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                        <td class="px-2 py-3"><input type="number" id="player4_hits" placeholder="0" min="0" class="w-16 border border-gray-300 rounded px-1 py-1 text-xs text-center focus:ring-2 focus:ring-red-500 focus:border-red-500" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Team Summary (full width below results) -->
                <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Team Summary</h3>
                        <a 
                            href="https://erikmadams.github.io/fortnite-dashboard/" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            class="text-white px-4 py-2 rounded-lg inline-flex items-center justify-center gap-2 font-medium transition-colors hover:opacity-90 text-sm"
                            style="background-color: #EE2A3E"
                        >
                            <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                            View Leaderboard
                        </a>
                    </div>
                    <div id="teamSummary">
                        <p class="text-gray-600">Fill out the form to see team statistics...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Scoring functions
        function getPlacementPoints(placement) {
            if (placement === 1) return 25;
            if (placement >= 2 && placement <= 5) return 20;
            if (placement >= 6 && placement <= 9) return 15;
            if (placement >= 10 && placement <= 18) return 10;
            if (placement >= 19 && placement <= 25) return 5;
            return 0;
        }

        function getEliminationPoints(eliminations) {
            return eliminations * 4;
        }

        function updateSummary() {
            const placement = parseInt(document.getElementById('teamPlacement').value) || 0;
            const eliminations = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_eliminations`).value) || 0);
            }, 0);
            
            const assists = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_assists`).value) || 0);
            }, 0);
            
            const revives = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_revives`).value) || 0);
            }, 0);
            
            // Calculate average accuracy (only count players with accuracy > 0)
            const validAccuracies = [1, 2, 3, 4].map(i => parseFloat(document.getElementById(`player${i}_accuracy`).value) || 0).filter(acc => acc > 0);
            const avgAccuracy = validAccuracies.length > 0 ? (validAccuracies.reduce((sum, acc) => sum + acc, 0) / validAccuracies.length).toFixed(1) : 0;
            
            const damageToPlayers = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_damageToPlayers`).value) || 0);
            }, 0);
            
            const damageTaken = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_damageTaken`).value) || 0);
            }, 0);
            
            const distanceTraveled = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_distanceTraveled`).value) || 0);
            }, 0);
            
            const hits = [1, 2, 3, 4].reduce((sum, i) => {
                return sum + (parseInt(document.getElementById(`player${i}_hits`).value) || 0);
            }, 0);
            
            const placementPoints = placement ? getPlacementPoints(placement) : 0;
            const eliminationPoints = getEliminationPoints(eliminations);
            const totalPoints = placementPoints + eliminationPoints;

            document.getElementById('teamSummary').innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold text-blue-600">${placement || '--'}</div>
                        <div class="text-sm text-blue-600">Team Placement</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold text-green-600">${eliminations}</div>
                        <div class="text-sm text-green-600">Total Eliminations</div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold text-yellow-600">${placementPoints}</div>
                        <div class="text-sm text-yellow-600">Placement Points</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-3 text-center">
                        <div class="text-2xl font-bold text-purple-600">${totalPoints}</div>
                        <div class="text-sm text-purple-600">Total Points</div>
                    </div>
                </div>
                
                <div class="border-t pt-4">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Detailed Team Statistics</h4>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-7 gap-3">
                        <div class="bg-red-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-red-600">${assists}</div>
                            <div class="text-xs text-red-600">Total Assists</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-green-600">${revives}</div>
                            <div class="text-xs text-green-600">Total Revives</div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-blue-600">${avgAccuracy}%</div>
                            <div class="text-xs text-blue-600">Avg Accuracy</div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-orange-600">${damageToPlayers.toLocaleString()}</div>
                            <div class="text-xs text-orange-600">Player Damage</div>
                        </div>
                        <div class="bg-indigo-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-indigo-600">${damageTaken.toLocaleString()}</div>
                            <div class="text-xs text-indigo-600">Damage Taken</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-purple-600">${distanceTraveled.toLocaleString()}</div>
                            <div class="text-xs text-purple-600">Distance Traveled</div>
                        </div>
                        <div class="bg-pink-50 rounded-lg p-3 text-center">
                            <div class="text-xl font-bold text-pink-600">${hits}</div>
                            <div class="text-xs text-pink-600">Total Hits</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Add event listeners for real-time updates
        document.addEventListener('input', updateSummary);
        
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.className = `mt-4 p-3 rounded-lg ${isError ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}`;
            status.textContent = message;
            status.classList.remove('hidden');
        }

        function saveResults() {
            const school = document.getElementById('school').value;
            const teamName = document.getElementById('teamName').value;
            const teamPlacement = document.getElementById('teamPlacement').value;
            
            if (!school.trim()) {
                showStatus('Error: Please select a school', true);
                return;
            }
            
            if (!teamName.trim()) {
                showStatus('Error: Please enter a team name', true);
                return;
            }
            
            if (!teamPlacement) {
                showStatus('Error: Please enter team placement', true);
                return;
            }

            // Collect all data
            const formData = {
                school: school,
                teamName: teamName,
                date: document.getElementById('date').value,
                gameMode: document.getElementById('gameMode').value,
                teamPlacement: parseInt(teamPlacement),
                players: [1, 2, 3, 4].map(i => ({
                    gamerTag: document.getElementById(`player${i}_gamerTag`).value || '',
                    eliminations: parseInt(document.getElementById(`player${i}_eliminations`).value) || 0,
                    assists: parseInt(document.getElementById(`player${i}_assists`).value) || 0,
                    revives: parseInt(document.getElementById(`player${i}_revives`).value) || 0,
                    accuracy: parseFloat(document.getElementById(`player${i}_accuracy`).value) || 0,
                    damageToPlayers: parseInt(document.getElementById(`player${i}_damageToPlayers`).value) || 0,
                    damageTaken: parseInt(document.getElementById(`player${i}_damageTaken`).value) || 0,
                    distanceTraveled: parseInt(document.getElementById(`player${i}_distanceTraveled`).value) || 0,
                    hits: parseInt(document.getElementById(`player${i}_hits`).value) || 0
                }))
            };

            // Calculate totals
            const totalEliminations = formData.players.reduce((sum, p) => sum + p.eliminations, 0);
            formData.totalEliminations = totalEliminations;
            formData.totalPoints = getPlacementPoints(formData.teamPlacement) + getEliminationPoints(totalEliminations);

            showStatus('Submitting your team results to the BattleBus Backend...');

            // Create an iframe to submit the data (bypasses CORS)
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.name = 'submitFrame';
            document.body.appendChild(iframe);

            // Create form to submit to iframe
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://script.google.com/macros/s/AKfycbwcsPlxJ-B0BnIK7mkPmwnWPJFkzWgoygfWsviMrzeBtrHtzfpzPiTI3alooIR9En0x/exec';
            form.target = 'submitFrame';
            
            // Add each piece of data as separate form fields to match sheet columns exactly
            const fields = {
                'school': formData.school,
                'teamName': formData.teamName,
                'date': formData.date,
                'gameMode': formData.gameMode,
                'teamPlacement': formData.teamPlacement,
                'totalPoints': formData.totalPoints,
                // Player 1 - all fields including damage taken
                'player1_gamerTag': formData.players[0].gamerTag,
                'player1_eliminations': formData.players[0].eliminations,
                'player1_assists': formData.players[0].assists,
                'player1_revives': formData.players[0].revives,
                'player1_accuracy': formData.players[0].accuracy,
                'player1_damageToPlayers': formData.players[0].damageToPlayers,
                'player1_damageTaken': formData.players[0].damageTaken,
                'player1_distanceTraveled': formData.players[0].distanceTraveled,
                'player1_hits': formData.players[0].hits,
                // Player 2 - all fields including damage taken
                'player2_gamerTag': formData.players[1].gamerTag,
                'player2_eliminations': formData.players[1].eliminations,
                'player2_assists': formData.players[1].assists,
                'player2_revives': formData.players[1].revives,
                'player2_accuracy': formData.players[1].accuracy,
                'player2_damageToPlayers': formData.players[1].damageToPlayers,
                'player2_damageTaken': formData.players[1].damageTaken,
                'player2_distanceTraveled': formData.players[1].distanceTraveled,
                'player2_hits': formData.players[1].hits,
                // Player 3 - all fields including damage taken
                'player3_gamerTag': formData.players[2].gamerTag,
                'player3_eliminations': formData.players[2].eliminations,
                'player3_assists': formData.players[2].assists,
                'player3_revives': formData.players[2].revives,
                'player3_accuracy': formData.players[2].accuracy,
                'player3_damageToPlayers': formData.players[2].damageToPlayers,
                'player3_damageTaken': formData.players[2].damageTaken,
                'player3_distanceTraveled': formData.players[2].distanceTraveled,
                'player3_hits': formData.players[2].hits,
                // Player 4 - all fields including damage taken
                'player4_gamerTag': formData.players[3].gamerTag,
                'player4_eliminations': formData.players[3].eliminations,
                'player4_assists': formData.players[3].assists,
                'player4_revives': formData.players[3].revives,
                'player4_accuracy': formData.players[3].accuracy,
                'player4_damageToPlayers': formData.players[3].damageToPlayers,
                'player4_damageTaken': formData.players[3].damageTaken,
                'player4_distanceTraveled': formData.players[3].distanceTraveled,
                'player4_hits': formData.players[3].hits,
                // Team totals
                'totalEliminations': formData.totalEliminations
            };

            for (const [key, value] of Object.entries(fields)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            document.body.appendChild(form);
            
            // Listen for iframe load to know when submission is complete
            iframe.onload = function() {
                setTimeout(() => {
                    showStatus(`Success! Data submitted for ${formData.teamName} with ${formData.totalPoints} points.`);
                    document.body.removeChild(form);
                    document.body.removeChild(iframe);
                }, 1000);
            };

            //Submit the form
            form.submit();

            // Wait for submission to complete (Google Apps Script typically responds within 2-3 seconds)
            setTimeout(() => {
                showStatus(`Success! Data submitted for ${formData.teamName} with ${formData.totalPoints} points.`);
                document.body.removeChild(form);
                document.body.removeChild(iframe);
            }, 3000);
        }

        // Initialize summary and set current date
        updateSummary();
        
        // Set today's date in the date field
        const today = new Date();
        const formattedDate = today.getFullYear() + '-' + 
            String(today.getMonth() + 1).padStart(2, '0') + '-' + 
            String(today.getDate()).padStart(2, '0');
        document.getElementById('date').value = formattedDate;
    </script>
</body>
</html>
